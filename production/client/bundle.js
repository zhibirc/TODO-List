(()=>{var e={790:()=>{window.addEventListener("error",(e=>{console.error("Error occurred during execution: ",e.error)})),window.addEventListener("unhandledrejection",(e=>{console.warn("Unhandled rejection from promise: ",e.promise)}))}},t={};function o(s){if(t[s])return t[s].exports;var r=t[s]={exports:{}};return e[s](r,r.exports,o),r.exports}(()=>{"use strict";o(790);const e=Object.freeze({API_BASE_PATH_URL:`${location.protocol}//${location.host}/api`,STORAGE_KEY_USER_INFO:"todo-s:user:info",STORAGE_KEY_APP_DATA:"todo-s:app:data",UI_THEME:"dark"}),t={get userInfo(){return localStorage.getItem(e.STORAGE_KEY_USER_INFO)},set userInfo(t){if("[object Object]"!==Object.prototype.toString.call(t))throw new Error("Saved data should be Object");localStorage.setItem(e.STORAGE_KEY_USER_INFO,JSON.stringify(t))},get appData(){return localStorage.getItem(e.STORAGE_KEY_APP_DATA)},set appData(t){if("[object Object]"!==Object.prototype.toString.call(t))throw new Error("Saved data should be Object");let o=this.appData;try{o=JSON.parse(o)}catch(e){o={},console.error(e)}localStorage.setItem(e.STORAGE_KEY_APP_DATA,Object.assign(o,JSON.stringify(t)))}},s=Symbol("RESOURCE_TYPE_PROJECT"),r=Symbol("RESOURCE_TYPE_TODO");class n{constructor(e={}){Object.assign(this,e)}static get RESOURCE_TYPE_PROJECT(){return s}static get RESOURCE_TYPE_TODO(){return r}remove(t,o){const s=t===n.RESOURCE_TYPE_PROJECT?"Project":"Task";return new Promise(((t,r)=>{fetch(`${e.API_BASE_PATH_URL}/delete${s}/${o}`,{method:"DELETE"}).then((async e=>{if(e.status>=400)throw new Error((await e.json()).code);return e})).catch((e=>console.error(e)&&r(e)))}))}update(t,o){const s=t===n.RESOURCE_TYPE_PROJECT?"Project":"Task";return new Promise(((t,r)=>{fetch(`${e.API_BASE_PATH_URL}/update${s}`,{method:"POST",body:JSON.stringify(o),headers:{"Content-type":"application/json"}}).then((async e=>{if(e.status>=400)throw new Error((await e.json()).code);return Object.assign(this,o),e.json()})).catch((e=>console.error(e)&&r(e)))}))}create(t,o){const s=t===n.RESOURCE_TYPE_PROJECT?"Project":"Task";return new Promise(((t,r)=>{fetch(`${e.API_BASE_PATH_URL}/add${s}`,{method:"POST",body:JSON.stringify(o),headers:{"Content-type":"application/json"}}).then((async e=>{if(e.status>=400)throw new Error((await e.json()).code);return e.json()})).catch((e=>console.error(e)&&r(e)))}))}static findAll(){return new Promise(((t,o)=>{fetch(e.API_BASE_PATH_URL+"/getUserData",{method:"GET"}).then((async e=>{if(e.status>=400)throw new Error((await e.json()).code);return e.json()})).catch((e=>console.error(e)&&o(e)))}))}}class a extends n{constructor(){super()}}const i=/^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i,c={email:e=>e.length<=254&&i.test(e),login:RegExp.prototype.test.bind(/^[a-z\d]{5,12}$/i),password:RegExp.prototype.test.bind(/^\S{8,50}$/),phone:RegExp.prototype.test.bind(/^\+?(?:\(\d{2,5}\))?(?:\d{2,4}-?){1,2}\d{2,4}$/)};function d(e){("string"==typeof e?h(e):e).classList.remove("hidden")}function l(e){("string"==typeof e?h(e):e).classList.add("hidden")}function h(e){return document.querySelector(e)}const u=()=>{},p=new class{constructor(e={}){Object.assign(this,e),this.events={}}addListener(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)}once(e,t){const o=this;this.events[e]=this.events[e]||[],this.events[e].push((function s(){o.removeListener(e,s),t.apply(o,arguments)}))}addListeners(e){let t;for(t in e)e.hasOwnProperty(t)&&this.addListener(t,e[t])}removeListener(e,t){this.events[e]&&(this.events[e]=this.events[e].filter((e=>e!==t)),0===this.events[e].length&&(this.events[e]=void 0))}emit(e){const t=this.events[e];if(t)for(let e=0;e<t.length;e+=1)t[e].apply(this,Array.prototype.slice.call(arguments,1))}}({dom:{$app:h("#app"),$preloader:h(".preloader"),buttons:{$createProject:h(".button-create-project")}},data:{storage:{theme:e.UI_THEME},runtime:null}});p.initWindowEvents=()=>{const e={"modal-auth-show":()=>d("#modal-auth"),"modal-auth":()=>l("#modal-auth"),"button-login":()=>p.login({login:h("#login").value,password:h("#password").value}),"button-login-cancel":()=>l("#modal-auth"),"button-close-modal-auth":()=>l("#modal-auth")};window.addEventListener("click",(t=>(e[t.target.id]||u)()))},p.login=async t=>{if(c.login(t.login)&&c.password(t.password)){d(p.dom.$preloader);try{await(o=t.login,s=t.password,new Promise(((t,r)=>{fetch(e.API_BASE_PATH_URL+"/sessions",{method:"POST",body:JSON.stringify({login:o,password:s}),headers:{"Content-type":"application/json"}}).then((e=>(e.status>=400&&r("Bad request"),e.json()))).then((e=>{p.user=new a,t(p.user)})).catch((e=>r(e)))}))),p.emit("auth:success")}catch(e){console.error(e),p.emit("auth:error")}l(p.dom.$preloader)}else d("#login-error-info");var o,s};const E=p;window.app=E;E.addListeners({"auth:success":e=>{console.log("AUTH::success"),t.userInfo=JSON.stringify(e),E.load()},"auth:error":()=>{console.log("AUTH::error")},logout:()=>{sessionStorage.clear(),localStorage.clear(),location.reload()}}),(async()=>{if(t.userInfo)E.dom.body.classList.add("ui-theme-"+E.data.storage.theme),E.initWindowEvents();else{const e=await fetch("src/views/public/index.html");200===e.status&&(E.dom.$app.innerHTML=await e.text(),E.initWindowEvents())}})()})()})();